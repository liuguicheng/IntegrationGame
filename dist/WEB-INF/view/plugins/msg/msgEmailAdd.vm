<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  #headInclude()
    <script type="text/javascript">
  
    </script>
   <link rel="stylesheet" type="text/css" href="../script/upload/webuploader.css">
</head>
<body>
<div class="PageHeader">
  <div class="LeftBox Title">发送反馈信息</div>
</div>

<div class="indieui-scroll">
<form name="editForm" method="post" action="../plugins/addEmailMessage.do" class="indieui-form">
  <input type="hidden" name="token" value="$!{token}" />
  <input type="hidden" name="submitFlag" value="0" />
  <input id="comid" type="hidden" name="sysMessageInfoId" value="$!{command.sysMessageInfoId}" />
  <input  type="hidden" name="messageType" value="3" />
  
  <table class="TbCommon">
    <tr>
      <td class="TdLabel" style="width:150px;">#requiredInput("标题")</td>
      <td class="TdInput"  >
		<input type="text" style="width:66%;" name="messageTitel" value="$!{command.messageTitel}" width="100%" />
      </td>
    </tr>
    <tr>
      <td class="TdLabel">#requiredInput("内容")<br/></td>
      <td class="TdInput" >
		<input id="contentid" type="hidden" name="content" value=""  />
		 <script id="editor" type="text/plain" style="width:98%;">$!{command.content}</script>
      </td>
    </tr>
    <tr>
        <td class="TdLabel">上传图片</td>
        <td  class="TdInput" >
			<div id="uploader-demo">
				<!--用来存放item-->
				<div id="fileList" class="uploader-list"></div>
				<div id="filePicker">选择图片</div>
			</div>
		</td>
	</tr>
	
  </table>
</form>
</div>

<div class="CommandTool indieui-form">
  <input type="button" id="btnconfirm" value="保存" onclick="javascript:doSave();"/>
   <input type="button" id="btnconfirm" value="返回" onclick="javascript:doReturn();"/>
</div>
<script type="text/javascript" src="../script/ueditor/ueditor.config.js"></script>
    <script type="text/javascript" src="../script/ueditor/ueditor.all.min.js"></script>
	 <script type="text/javascript" src="../script/ueditor/lang/zh-cn/zh-cn.js"></script>
	 <script type="text/javascript" src="../script/upload/webuploader.min.js"></script>
<script type="text/javascript">  
$(document).ready(function(){var ue=UE.getEditor("editor",{toolbars:[["undo","redo","bold","indent","italic","underline","fontfamily","fontsize","paragraph","forecolor","backcolor","insertorderedlist"]],autoHeightEnabled:true,autoFloatEnabled:true});var $=jQuery,$list=$("#fileList"),ratio=window.devicePixelRatio||1,thumbnailWidth=0,thumbnailHeight=0,uploader;uploader=WebUploader.create({auto:true,swf:"../script/upload/Uploader.swf",server:"../upload/save.do",pick:{id:"#filePicker",label:"点击选择图片"},chunked:false,chunkSize:512*1024,thumb:{width:220,height:200,allowMagnify:true,crop:false},accept:{title:"Images",extensions:"gif,jpg,jpeg,bmp,png",mimeTypes:"image/jpg,image/jpeg,image/png"},formData:{"messageid":123},disableGlobalDnd:true,fileNumLimit:300,fileSizeLimit:200*1024*1024,fileSingleSizeLimit:50*1024*1024});uploader.on("fileQueued",function(file){var $li=$('<div id="'+file.id+'" class="file-item thumbnail">'+'<input class="imgname" type="hidden" value="" />'+"<img>"+'<div class="info">'+file.name+'</div><span class="cancel"  onclick=javascript:dodel("'+file.id+'")>删除</span>'+"</div>"),$img=$li.find("img");$list.append($li);uploader.makeThumb(file,function(error,src){if(error){$img.replaceWith("<span>不能预览</span>");return}$img.attr("src",src)},thumbnailWidth,thumbnailHeight)});uploader.on("uploadProgress",function(file,percentage){var $li=$("#"+file.id),$percent=$li.find(".progress span");if(!$percent.length){$percent=$('<p class="progress"><span></span></p>').appendTo($li).find("span")}$percent.css("width",percentage*100+"%")});uploader.on("uploadSuccess",function(file){$("#"+file.id).addClass("upload-state-done")});uploader.on("uploadError",function(file){var $li=$("#"+file.id),$error=$li.find("div.error");if(!$error.length){$error=$('<div class="error"></div>').appendTo($li)}$error.text("上传失败")});uploader.on("uploadComplete",function(file){$("#"+file.id).find(".progress").remove()});uploader.on("uploadAccept",function(file,response){if(response.code==0){return false}else{$("#"+file.file.id).find(".imgname").val(response.message)}});dodel=function(id){var filename=$("#"+id).find(".imgname").val();if(filename!=""){$.ajax({url:"../upload/delAjax.do",type:"POST",data:"filename="+filename,cache:false,success:function(result){if(result!=""){var s=$.parseJSON(result);if(s.code==1){uploader.removeFile(uploader.getFile(id),true);$("#"+id).remove()}else{alert("删除失败")}}}})}}});



  function doSave(){
    ue.ready(function() {
		var arr=ue.getContent();
		if($.trim(arr)==""){
	 		alert("请填写内容信息！");
			return false;
		}else{
			$("#contentid").val(arr);
		 	var e = document.editForm;
    		if (checkInput(e)) {
     		 	e.submitFlag.value = "1";
      		 	e.submit();
    		}
		}
		
	});
	
   
  }
  function checkInput(e) {
    if (e.submitFlag.value == "1") {
      alert("当前页面已经提交，请稍等！");
      return false;
    }
    return validator.checkAll();
  }
  
  function doReturn() {
    document.location.href = "../plugins/messageEmailList.do";
  }



</script>

</body>
</html>
