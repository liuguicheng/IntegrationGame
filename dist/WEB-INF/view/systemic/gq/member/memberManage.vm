<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  #headInclude()
  <script type="text/javascript">
  #if($message)alert("#javaScriptEscape($message)");#end

  function doEdit(memberId) {
    var url = "../member/memberEdit.do?token=$!{command.token}&memberId=" + memberId;
    document.location.href = url;
  }

  function doDelete() {
    if (!hasCheckBoxSelect("memberId")) {
      alert("请选择要删除的玩家！");
      return;
    }
    if (confirm("您确定要删除所选择的玩家吗?")) {
      var f =  document.listForm;
      f.action = "../member/memberDelete.do";
      f.submit();      
    }
  }
  
  </script>
</head>
<body>
<div class="PageHeader">
  <div class="LeftBox Title">玩家管理列表</div>
</div>
<!--搜索div开始 -->
<div class="SearchBox" id="divSearch">
<form name="queryForm" action="#getRequestUri()" method="post" class="indieui-form">
  <table class="TbCommon">
    <tr>
      <td class="TdLabel" style="width:100px;">玩家编号：</td>
      <td class="TdInput">
        <input type="text" name="staffId" value="" >
      </td>
      <td class="TdLabel" style="width:100px;">玩家姓名：</td>
      <td class="TdInput">
        <input type="text" name="zsxm" value="" >
      </td>
    </tr>
  </table>
  <div class="CommandTool">
    <input type="button" value="确 定" onClick="javascript:document.queryForm.submit();jQuery('body').processMask();"/>
    <input type="button" value="清 空" onClick="javascript:clearQuery(document.queryForm);"/>
    <input type="button" value="取 消" onClick="javascript:showDiv('divSearch');">    
  </div>
</form>
</div>
<!--搜索div结束-->
<!--申请参与游戏div开始 -->
<div class="SearchBox" id="apply">
<form name="applyForm" action="../member/activationMemberAjax.do" method="post" class="indieui-form" id="applyform">
  <table class="TbCommon">
    <tr>
      <td class="TdLabel" style="width:100px;">玩家编号:</td>
      <td class="TdInput" colspan="3">
        <input type="text" name="staffId" value="" id="applystaffId" readonly >
      </td>
    </tr>
	<tr>
      <td class="TdLabel" style="width:100px;">推荐点编号:</td>
      <td class="TdInput">
        <input type="text" name="referenceId" value="" id="applyreferenceId" readonly>
      </td>
      <td class="TdLabel" style="width:100px;">推荐点推荐链接:</td>
      <td class="TdInput">
        <input type="text" value="" id="applyreferenceqRCodeContent" readonly>
      </td>
    </tr>
	<tr>
      <td class="TdLabel" style="width:100px;">#requiredInput("归属点编号:")</td>
      <td class="TdInput">
        <input type="text" name="note" value="" id="applynote" onchange="selectNote(this);">
      </td>
      <td class="TdLabel" style="width:100px;">#requiredInput("归属点推荐链接:")</td>
      <td class="TdInput">
        <input type="text" name="qRCodeContent" value="" id="applynoteqRCodeContent" >
		<input type="hidden" name="noteQRCodeImageUrl" value="" id="applynoteQRCodeImageUrl" >
      </td>
    </tr>
  </table>
  <div class="CommandTool">
    <input type="button" value="提交" onclick="doapply();"/>
  </div>
</form>
</div>
<!--申请参与游戏div结束 -->
<!--审核申请参与游戏div开始 -->
<div class="SearchBox" id="audit">
<form name="dForm" action="" method="post" class="indieui-form" id="auditform">
  <table class="TbCommon">
    <tr>
      <td class="TdLabel" style="width:100px;">玩家编号：</td>
      <td class="TdInput">
        <input type="text" name="staffId" value="" id="auditstaffId" readonly >
      </td>
      <td class="TdLabel" style="width:100px;">推荐人编号：</td>
      <td class="TdInput">
        <input type="text" name="referenceId" value="" id="auditreferenceId" readonly>
      </td>
    </tr>
	<tr>
      <td class="TdLabel" style="width:100px;">归属人编号：</td>
      <td class="TdInput">
        <input type="text" name="note" value="" id="auditnote" readonly>
      </td>
      <td class="TdLabel" style="width:100px;">审核结果：</td>
      <td class="TdInput">
		    <input type="radio" id="male" name="istrue" value="2"/><label for="male"  >同意</label>&nbsp;&nbsp;
			<input type="radio" id="male" name="istrue" value="3" checked="checked"/><label for="male"  >拒绝</label>
      </td>
    </tr>
  </table>
  <div class="CommandTool">
    <input type="button" value="提交" onClick="doaudit();"/>
  </div>
</form>
</div>
<!--审核申请参与游戏div结束 -->

<div class="PageTool">
  <div class="LeftBox Tool">
    <input type="button" class="BtnSearch" value="查询"  title="查询" onclick="javascript:showDiv('divSearch');"/>
    <input type="button" class="BtnAdd" value="玩家注册"  title="新增" onclick="javascript:doEdit('');"/>
    <input type="button" class="BtnDel" value="删除"  title="删除" onclick="javascript:doDelete();"/>
  </div>
</div>

<div class="PageContainer indieui-scroll">
<form name="listForm" method="post">
<input type="hidden" name="submitFlag" value="0">
<input type="hidden" name="token" value="$!{command.token}">
<table class="TbList">
  <thead> 
    <tr>
      <th style="width:20px;" nowrap>
        <input type="checkbox" onclick="javascript:setCheckBoxValue('memberId', this.checked);">
      </th>
        <th >玩家编号</th>
		<th >二维码</th> 
        <th >级别</th>
        <th >总积分</th>  
		<th >推荐人编号</th> 
		<th >归属人编号</th> 
		<th >注册时间</th> 
		<th >参与游戏时间</th> 
		<th >状态</th>
		<th >操作</th> 
    </tr>
  </thead>
  <tbody>
  #foreach( $data in $page.data )
    <tr>
      <td><input type="checkbox" name="memberId" value="$!{data.memberId}"></td>
      <td><a href="../member/MemberInfo.do?memberId=$!{data.memberId}">$!{data.staffId}</a></td>
      <td>
		#if(!${data.qRCodeImageUrl})
			暂无二维码
		#else
			<img src="../imgss.jsp?file=$!{data.qRCodeImageUrl}"height="50%"	>
		#end	
		</td>
      <td>#lookUpDict($dicData.dicStockLevel "$!{data.stock.gradeNum}")</td>
      <td>$!{data.integral}</td>
      <td >$!{data.referenceId}</td>
	  <td >$!{data.note}</td>
      <td >#formatTime(${data.createTime})</td>
	  <td >#if(${data.activationTime})
			暂未参加
			#else
				#formatTime(${data.activationTime})
			#end
		</td>
		<td >#if(${data.isok}==1)
				正常
			#else
				锁定
			#end
		</td>
	  <td ><a href="">[修改级别]</a> 
		#if($!{data.isActivation}==0)
			<a href="javascript:activation('$!{data.memberId}','$!{data.referenceId}','$!{data.referenceQRCodeContent}')">[申请加入游戏]</a> 
		#elseif($!{data.isActivation}==1)
			<a href="javascript:audit('$!{data.memberId}','$!{data.referenceId}','$!{data.note}')">[审核]</a> 
		#elseif($!{data.isActivation}==2)
			<a href="javascript:doQRCode('$!{data.memberId}')">[生成二维码]</a> 
		#end	
		</td>
    </tr>
  #end
  </tbody>   
</table>
</form>
</div>

<div data-options="region:'south'" style="overflow-y:hidden"> 
#pageDirector($page "#getRequestUri()" "")
</div>
<script type="text/javascript">
function doQRCode(id){
 if (confirm("您确定要生成该玩家的二维码吗?")) {
		$.ajax({
        	url: '../member/memberQRCodeAjax.do',
       	 	type: 'POST',
			data:"memberId="+id, 
       	 	cache: false,
        	success: function(result) {
				var s=$.parseJSON(result);//内容
				if(s.length>0){
					if(s[0].code==1){
						alert("生成成功");
						location.reload(); 
					}else{
						alert("生成失败");
					}
				}else{
					alert("生成失败");
				}
				
        	}
   		});
		}
}


function audit(id,referenceId,note){
		$("#auditstaffId").val(id);
		$("#auditreferenceId").val(referenceId);
		$("#auditnote").val(note);
		var width = width || 800;
	    var divobj = $("#audit");
	    if(divobj.is(":visible")) {
	        divobj.searchBox("close");
	    } else  {
	        divobj.searchBox({title: "审核", width: width });
	    }
}

function doaudit(){
		$.ajax({
        	url: '../member/fauditMemberAjax.do',
       	 	type: 'POST',
			data:$("#auditform").serialize(),// 你的formid
       	 	cache: false,
        	success: function(result) {
				var s=$.parseJSON(result);//内容
				var str=s[0].message;
				alert(str);
				location.reload(); 				
        	}
   		});
	
}


function activation(id,referenceId,referenceqRCodeContent){
	    $("#applystaffId").val(id);
		$("#applyreferenceId").val(referenceId);
		$("#applyreferenceqRCodeContent").val(referenceqRCodeContent);
		var width = width || 800;
	    var divobj = $("#apply");
	    if(divobj.is(":visible")) {
	        divobj.searchBox("close");
	    } else  {
	        divobj.searchBox({title: "申请参与游戏", width: width });
	    }
}
function selectNote(){
 	var note=$("#note").val();
	if(note!=""){
		$.ajax({
        	url: '../member/memberAjax.do',
       	 	type: 'POST',
			data:"memberId="+note, 
       	 	cache: false,
        	success: function(result) {
				var s=$.parseJSON(result);//内容
				if(s.length>0){
					if(s[0].code==1){
						var str=s[0].message;
				 		var res=str.split(",");
				 		$("#applynoteqRCodeContent").val(res[0]);
				 		$("#applynoteQRCodeImageUrl").val(res[1]);
					}else{
						alert("您输入的归属节点编号不存在!");
						$("#applynoteqRCodeContent").val("");
				 		$("#applynoteQRCodeImageUrl").val("");
					}
				}else{
					alert("您输入的归属节点编号不存在!");
					$("#applynoteqRCodeContent").val("");
				 		$("#applynoteQRCodeImageUrl").val("");
				}
				
        	}
   		});
	}
	
}

function doapply(){
 	var note=$("#note").val();
	if(note!=""){
		$.ajax({
        	url: '../member/activationMemberAjax.do',
       	 	type: 'POST',
			data:$("#applyform").serialize(),// 你的formid
       	 	cache: false,
        	success: function(result) {
				var s=$.parseJSON(result);//内容
				var str=s[0].message;
				alert(str);
				location.reload(); 				
        	}
   		});
	}else{
		alert("归属节点不能为空!");
	}
	
}
</script>
</body>
</html>
