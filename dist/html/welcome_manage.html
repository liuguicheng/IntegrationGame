<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="renderer" content="webkit">
<meta http-equiv="Cache-Control" content="no-siteapp">
<title>主页</title>
<meta name="keywords" content="">
<meta name="description" content="">
<!--[if lt IE 9]>
    <meta http-equiv="refresh" content="0;ie.html" />
    <![endif]-->
<link href="../skins/skinsH/css/bootstrap.min.css?v=3.3.5"
	rel="stylesheet">
<link href="../skins/skinsH/css/font-awesome.min.css-v=4.4.0.css"
	rel="stylesheet">
<link href="../skins/skinsH/css/animate.min.css" rel="stylesheet">
<link href="../skins/skinsH/css/style.min.css?v=4.0.0" rel="stylesheet">
<link rel="stylesheet"
	href="../skins/skinsH/css/plugins/layer/layer.css"
	id="layui_layer_skinlayercss">
<link rel="stylesheet"
	href="../skins/skinsH/css/plugins/layer/layer.ext.css"
	id="layui_layer_skinlayerextcss">
<link rel="stylesheet"
	href="../skins/skinsH/css/plugins/layer/moon_style.css"
	id="layui_layer_skinmoonstylecss">
</head>

<body class="gray-bg">
	<div style="overflow: auto; overflow-x: hidden" id="mainid">

		<div class="row  border-bottom white-bg dashboard-header">
			<div class="col-sm-4">
				<h2>
					欢迎您&nbsp;<span id="username"></span>
					<br/>
					账&nbsp;&nbsp; 号:&nbsp;<span id="bhid" style="color:red;"></span>&nbsp;<span class="badge badge-danger"
						id="xzspan" style="font-size: 30px">孝</span><br/>
				</h2><input type="hidden" id="urlid">
				<small><b>专属二维码:</b></small><br /> <img
					src="../images/1.png" width="100%" id="qRCodeImageUrl"
					style="max-width: 300px; margin-left: -27px;"> <br/>
				<small><b>专属推广链接:</b><a id="qRCodeContent" href="">http://localhost:8080/IntegrationGame/main/home.do</a>
					<a class="btn btn-success" href="javascript:share();"> <i class="fa fa-weixin"> </i> 马上分享
				</a></small><br /> 
			</div>
			<div class="col-sm-4">
				<h4>最新反馈</h4>
				<br />
				<div id="fkdiv">暂无反馈信息</div>
			</div>
			<div class="col-sm-4">
				<h4>最新消息</h4>
				<br />
				<div id="messagediv">暂无消息信息</div>
			</div>
		</div>

		<div class="wrapper wrapper-content">
			<div class="row">
				<div class="col-sm-3">
					<div class="ibox float-e-margins">
						<div class="ibox-title">
							<span class="label label-success pull-right">年</span>
							<h5>玩家总量</h5>
						</div>
						<div class="ibox-content">
							<h1 class="no-margins" id="membernum">0</h1>
						</div>
					</div>
				</div>
				<div class="col-sm-3">
					<div class="ibox float-e-margins">
						<div class="ibox-title">
							<span class="label label-danger pull-right">月</span>
							<h5>活跃玩家</h5>
						</div>
						<div class="ibox-content">
							<h1 class="no-margins" id="memberh">0</h1>

						</div>
					</div>
				</div>
				<div class="col-md-3">
					<div class="ibox float-e-margins">
						<div class="ibox-title">
							<span class="label label-success pull-right">年</span>
							<h5>被封玩家</h5>
						</div>
						<div class="ibox-content">
							<h1 class="no-margins" id="memberf">0</h1>
						</div>
					</div>
				</div>
				<div class="col-sm-3">
					<div class="ibox float-e-margins">
						<div class="ibox-title">
							<span class="label label-primary pull-right"> 日</span>
							<h5>新增玩家</h5>
						</div>
						<div class="ibox-content">
							<h1 class="no-margins" id="memberx">0</h1>

						</div>
					</div>
				</div>

				<div class="col-sm-12 ui-sortable">
					<div class="ibox float-e-margins">
						<div class="ibox-title" >
							<h5>认证申请-提醒</h5>
							<div class="ibox-tools">
								<a class="collapse-link ui-sortable" href="../member/memberApplyGradeManage.do"> <!--  <i class="fa fa-chevron-up"></i>-->
									查看更多
								</a>
							</div>
						</div>
						<div class="ibox-content no-padding">
							<ul class="list-group" id="spdiv">
								

							</ul>
						</div>

					</div>
				</div>

			</div>
		</div>
	</div>
	<script src="../skins/skinsH/js/jquery.min.js"></script>
	<script src="../skins/skinsH/js/bootstrap.min.js"></script>
	<script src="../skins/skinsH/js/plugins/flot/jquery.flot.js"></script>
	<script
		src="../skins/skinsH/js/plugins/flot/jquery.flot.tooltip.min.js"></script>
	<script src="../skins/skinsH/js/plugins/flot/jquery.flot.spline.js"></script>
	<script src="../skins/skinsH/js/plugins/flot/jquery.flot.resize.js"></script>
	<script src="../skins/skinsH/js/plugins/flot/jquery.flot.pie.js"></script>
	<script src="../skins/skinsH/js/plugins/peity/jquery.peity.min.js"></script>
	<script src="../skins/skinsH/js/demo/peity-demo.min.js"></script>
	<script src="../skins/skinsH/js/content.min.js"></script>
	<script src="../skins/skinsH/js/plugins/jquery-ui/jquery-ui.min.js"></script>
	<script src="../skins/skinsH/js/plugins/gritter/jquery.gritter.min.js"></script>
	<script
		src="../skins/skinsH/js/plugins/easypiechart/jquery.easypiechart.js"></script>
	<script
		src="../skins/skinsH/js/plugins/sparkline/jquery.sparkline.min.js"></script>
	<script src="../skins/skinsH/js/demo/sparkline-demo.min.js"></script>
	<script type="text/javascript">
		$(document).ready(function() {
			// 滚动条
			document.body.scrollTop;
			$(document).scrollTop();
			$("#mainid").css("height", getPageSize() + "px");
			//监控屏幕窗口改变
			$(window).resize(function() {
				$("#mainid").css("height", getPageSize() + "px");
			})

			//获取基础信息
			selectMemberInfo();
			//获取数据统计
			selectCount();
			//获取最新反馈
			selectfeedback();
			//获取消息
			selectmessageAjax();
			//获取升级审批
			selectspdAjax();
			
			
			 
		});

		// 获取页面的高度、宽度
		function getPageSize() {
			var xScroll, yScroll;
			if (window.innerHeight && window.scrollMaxY) {
				xScroll = window.innerWidth + window.scrollMaxX;
				yScroll = window.innerHeight + window.scrollMaxY;
			} else {
				if (document.body.scrollHeight > document.body.offsetHeight) { // all but Explorer Mac    
					xScroll = document.body.scrollWidth;
					yScroll = document.body.scrollHeight;
				} else { // Explorer Mac...would also work in Explorer 6 Strict, Mozilla and Safari    
					xScroll = document.body.offsetWidth;
					yScroll = document.body.offsetHeight;
				}
			}
			var windowWidth, windowHeight;
			if (self.innerHeight) { // all except Explorer    
				if (document.documentElement.clientWidth) {
					windowWidth = document.documentElement.clientWidth;
				} else {
					windowWidth = self.innerWidth;
				}
				windowHeight = self.innerHeight;
			} else {
				if (document.documentElement
						&& document.documentElement.clientHeight) { // Explorer 6 Strict Mode    
					windowWidth = document.documentElement.clientWidth;
					windowHeight = document.documentElement.clientHeight;
				} else {
					if (document.body) { // other Explorers    
						windowWidth = document.body.clientWidth;
						windowHeight = document.body.clientHeight;
					}
				}
			}
			// for small pages with total height less then height of the viewport    
			if (yScroll < windowHeight) {
				pageHeight = windowHeight;
			} else {
				pageHeight = yScroll;
			}
			// for small pages with total width less then width of the viewport    
			if (xScroll < windowWidth) {
				pageWidth = xScroll;
			} else {
				pageWidth = windowWidth;
			}
			arrayPageSize = new Array(pageWidth, pageHeight, windowWidth,
					windowHeight);
			return windowHeight;
		}
		
		//查询当前登录用户
		function selectMemberInfo() {
			$.ajax({
				url : '../member/selectMemberInfoAjax.do',
				type : 'POST',
				cache : false,
				success : function(result) {
					var s = $.parseJSON(result);
					$("#bhid").html(s[0].userName);
					$("#urlid").val(s[0].qRCodeContent);
					var jsd="javascript:openurl('"+s[0].qRCodeContent+"')";
					$("#qRCodeContent").attr("href",jsd);
					$("#username").html(s[0].bsid);
					$("#qRCodeImageUrl").attr("src","../imgss.jsp?file="+s[0].qRCodeImageUrl);
					if (GetLength(s[0].qRCodeContent) > 40) { 
					       $("#qRCodeContent").html(cutstr(s[0].qRCodeContent, 40)); 
					       return; 
					 } else{
						 $("#qRCodeContent").html(s[0].qRCodeContent);
					 }
					
				}
			});
		}

		//查询统计
		function selectCount() {
			$.ajax({
				url : '../member/statisticsAjax.do',
				type : 'POST',
				cache : false,
				success : function(result) {
					var s = $.parseJSON(result);
					var st=s[0].message.split(",");
					$("#membernum").html(st[0]+"人");
					$("#memberh").html(st[1]+"人");
					$("#memberf").html(st[2]+"人");
					$("#memberx").html(st[3]+"人");
				}
			});
		}
		
		//查询最新反馈
		function selectfeedback() {
			$.ajax({
				url : '../member/selectfeedbackAjax.do',
				type : 'POST',
				cache : false,
				success : function(result) {
					if(result!=""){
						var s = $.parseJSON(result);
						var divs="";
						$.each(s, function(key, val) {
							if(s.length>3){
								if(key<3){
									divs+="<p class='text-success'>"+
									"<a href=javascript:openurl('../plugins/messageEmailList.do?sysMessageInfoId="+val.sysMessageInfoId+"')>"+
									" <span class='col-sm-6'>"+val.messageTitel+"</span> <span class='col-sm-1'></span>"+
									" "+val.content+"<span class='badge badge-danger'>new</span>"+
									"</a>"+
									" </p>";
								}else{
									if(key<12){
									divs+="<p class='text-success'>"+
									"<a href=javascript:openurl('../plugins/messageEmailList.do?sysMessageInfoId="+val.sysMessageInfoId+"')>"+
									" <span class='col-sm-6'>"+val.messageTitel+"</span> <span class='col-sm-1'></span>"+
									" "+val.content+
									"</a>"+
									" </p>";
									}
								}
							}else{
								divs+="<p class='text-success'>"+
								"<a href=javascript:openurl('../plugins/messageEmailList.do?sysMessageInfoId="+val.sysMessageInfoId+"')>"+
								" <span class='col-sm-6'>"+val.messageTitel+"</span> <span class='col-sm-1'></span>"+
								" "+val.content+" <span class='badge badge-danger'>new</span>"+
								"</a>"+
								" </p>";
							}
						});
					    $("#fkdiv").html(divs);
					}
				}
			});
		}
		
		//查询消息
		function selectmessageAjax() {
			$.ajax({
				url : '../member/selectmessageAjax.do',
				type : 'POST',
				data:"messageType=1",
				cache : false,
				success : function(result) {
					if(result!=""){
						var s = $.parseJSON(result);
						var divs="";
						$.each(s, function(key, val) {
							if(s.length>3){
								if(key<3){
									divs+="<p class='text-success'>"+
									"<a href=javascript:openurl('../plugins/messageList.do?sysMessageInfoId="+val.sysMessageInfoId+"')>"+
									" <span class='col-sm-6'>"+val.messageTitel+"</span> <span class='col-sm-1'></span>"+
									" "+val.content+" <span class='badge badge-danger'>new</span>"+
									"</a>"+
									" </p>";
								}else{
									if(key<12){
									divs+="<p class='text-success'>"+
									"<a href=javascript:openurl('../plugins/messageList.do?sysMessageInfoId="+val.sysMessageInfoId+"')>"+
									" <span class='col-sm-6'>"+val.messageTitel+"</span> <span class='col-sm-1'></span>"+
									" "+val.content+
									"</a>"+
									" </p>";
									}
								}
							}else{
								divs+="<p class='text-success'>"+
								"<a href=javascript:openurl('../plugins/messageList.do?sysMessageInfoId="+val.sysMessageInfoId+"')>"+
								" <span class='col-sm-6'>"+val.messageTitel+"</span> <span class='col-sm-1'></span>"+
								" "+val.content+" <span class='badge badge-danger'>new</span>"+
								"</a>"+
								" </p>";
							}
							
						});
					    $("#messagediv").html(divs);
					}
				}
			});
		}
		
		//查询待审批
		function selectspdAjax() {
			$.ajax({
				url : '../member/selectspmessageAjax.do',
				type : 'POST',
				cache : false,
				success : function(result) {
					var divs="";
					if(result!=""){
						var s = $.parseJSON(result);
						$.each(s, function(key, val) {
							if(s.length>3){
								if(key<3){
									divs+="<li class='list-group-item'>"+
									"<p>"+
									"<a class='text-info' href=javascript:openurl('..member/memberApplyGradeManage.do?memberId="+val.memberId+"')>玩家呢称:#"+val.bsid+"#</a>"+
									"玩家编号:"+val.userName+",申请升级 <span class='badge badge-danger'>new</span>"+
								"</p> <small class='block text-muted'><i"+
									" class='fa fa-clock-o'></i> "+val.referenceQRCodeContent+"</small>"+
								"</li>";
								}else{
									if(key<12){
									divs+="<li class='list-group-item'>"+
									"<p>"+
									"<a class='text-info' href=javascript:openurl('..member/memberApplyGradeManage.do?memberId="+val.memberId+"')>玩家呢称:#"+val.bsid+"#</a>"+
									"玩家编号:"+val.userName+",申请升级" +
								"</p> <small class='block text-muted'><i"+
									" class='fa fa-clock-o'></i> "+val.referenceQRCodeContent+"</small>"+
								"</li>";
									}
								}
							}else{
								divs+="<li class='list-group-item'>"+
								"<p>"+
								"<a class='text-info' href=javascript:openurl('..member/memberApplyGradeManage.do?memberId="+val.memberId+"')>玩家呢称:#"+val.bsid+"#</a>"+
								"玩家编号:"+val.userName+",申请升级 <span class='badge badge-danger'>new</span>"+
							"</p> <small class='block text-muted'><i"+
								" class='fa fa-clock-o'></i> "+val.referenceQRCodeContent+"</small>"+
							"</li>";
							}
							
						});
					    $("#spdiv").html(divs);
					}else{
						divs+="<li class='list-group-item'>暂无认证申请审核</li>";
						$("#spdiv").html(divs);
					}
				}
			});
		}
		
		
		  var GetLength = function (str) {
		        ///<summary>获得字符串实际长度，中文2，英文1</summary>
		        ///<param name="str">要获得长度的字符串</param>
		        var realLength = 0, len = str.length, charCode = -1;
		        for (var i = 0; i < len; i++) {
		            charCode = str.charCodeAt(i);
		            if (charCode >= 0 && charCode <= 128) realLength += 1;
		            else realLength += 2;
		        }
		        return realLength;
		    };
		 /** 
	     * js截取字符串，中英文都能用 
	     * @param str：需要截取的字符串 
	     * @param len: 需要截取的长度 
	     */
	    function cutstr(str, len) {
	        var str_length = 0;
	        var str_len = 0;
	        str_cut = new String();
	        str_len = str.length;
	        for (var i = 0; i < str_len; i++) {
	            a = str.charAt(i);
	            str_length++;
	            if (escape(a).length > 4) {
	                //中文字符的长度经编码之后大于4  
	                str_length++;
	            }
	            str_cut = str_cut.concat(a);
	            if (str_length >= len) {
	                str_cut = str_cut.concat("...");
	                return str_cut;
	            }
	        }
	        //如果给定字符串小于指定长度，则返回源字符串；  
	        if (str_length < len) {
	            return str;
	        }
	    }
		    
	    function share(){
			var qrcodeurl=$("#qRCodeImageUrl").attr("src");
			var qRCodeContent=$("#urlid").val();
			if(qrcodeurl!=""){
				var sd=qrcodeurl.split("?file=");
				console.log(sd);
				//window.location.href="share.html?id="+sd[1];
				window.open("share.html?id="+sd[1]+"&url="+qRCodeContent)
			}
			
		}
	    function openurl(url){
			window.open(url);
		}
	</script>
</body>
</html>
